
"""
Author: Jiang Li (jiangli@umass.edu)
"""

direct = [
    [558.2306578159332, 1829.773288011551, 3609.6431090831757, 6420.87073802948, 10211.48302102089, 14750.233685016632, 18895.740686178207, 22473.46243405342, 37383.61820411682, 66010.41671705246],
    [148.49930119514465, 556.3155546188354, 1374.5102760791779, 2505.2632491588593, 4316.55988574028, 8620.684856891632, 12723.731763839722, 16495.302155971527, 19386.604343891144, 26418.092468976974],
    [159.51824593544006, 879.5198590755463, 2953.755286693573, 6414.4703159332275, 11249.388313770294, 17896.54030108452, 23887.69083595276, 34033.491158008575, 39754.3114862442, 48458.457894802094],
    [209.26293301582336, 1088.0784902572632, 3484.9051311016083, 7141.136322021484, 11529.970471858978, 17434.795949220657, 22119.554977178574, 29521.03555703163, 35466.1697909832, 42928.570551872253]
]


partition_nums = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400, 500, 600, 1000]

sketch_refine = [
    [11.977996826171875, 3.388704299926758, 2.519056797027588, 1.4666588306427002, 1.457170009613037, 1.5425667762756348, 1.1635024547576904, 1.244370937347412, 0.8746590614318848, 0.7269349098205566, 0.45450615882873535],
    [3.165276050567627, 10.559129238128662, 3.3703293800354004, 10.423754453659058, 6.142751455307007, 6.010455131530762, 4.343945026397705, 0.765143871307373, 3.3002891540527344, 0.44013094902038574, 0.34041690826416016],
    [999.3109514713287, 507.515478849411, 2924.431787967682, 413.12285447120667, 330.235470533371, 281.7295300960541, 266.46525144577026, 252.60203528404236, 244.56408762931824, 238.94331622123718, 212.43612480163574],
    [107.67674207687378, 45.5819525718689, 1.098698616027832, 12.029425144195557, 16.19922685623169, 0.9865024089813232, 7.761031866073608, 0.5554335117340088, 3.0828793048858643, 0.6664361953735352, 1.3886632919311523]
]
'''trimmed out infeasible cases'''
sketch_refine = [
    [11.977996826171875, 3.388704299926758, 2.519056797027588, 1.4666588306427002, 1.457170009613037, 1.5425667762756348, 1.1635024547576904, 1.244370937347412, 0.8746590614318848, 0.7269349098205566, 0.45450615882873535,0.943342924118042, 0.5302097797393799, 0.8131048679351807, 0.34215855598449707, 0.35253143310546875],
    [None, 10.559129238128662, None, 10.423754453659058, 6.142751455307007, 6.010455131530762, 4.343945026397705, None, 3.3002891540527344, 0.44013094902038574, 0.34041690826416016,337.1650629043579, 349.6670789718628, 331.29498052597046, 350.1021716594696, 392.5211820602417],
    [999.3109514713287, 507.515478849411, 2924.431787967682, 413.12285447120667, 330.235470533371, 281.7295300960541, 266.46525144577026, 252.60203528404236, 244.56408762931824, 238.94331622123718, 212.43612480163574,383.0279242992401, 195.65665102005005, 190.98262643814087, 191.3193428516388, 193.65413689613342],
    [107.67674207687378, 45.5819525718689, None, 12.029425144195557, 16.19922685623169, None, 7.761031866073608, None, 3.0828793048858643, None, 1.3886632919311523,1.784822702407837, 1.2110674381256104, 0.5884027481079102, 0.8807957172393799, 0.5249021053314209]
]


'''add up partitioning time'''
sketch_refine_adds_partition = []
p = [50,93,153, 192,238,345,444,510,550,610,1210, 1794, 2286, 7383, 12034, 26220]
for i in range(len(sketch_refine)):
    row = []
    for j in range(len(sketch_refine[0])):
        if sketch_refine[i][j] is not None:
            row.append(sketch_refine[i][j] + p[j])
        else:
            row.append(None)
    sketch_refine_adds_partition.append(row)



import matplotlib.pyplot as plt

plt.figure()

for i in range(len(sketch_refine_adds_partition)):
    plt.subplot(1,len(sketch_refine_adds_partition),i+1)
    if i == 0: plt.ylabel("Time (s)")
    sk = plt.plot(partition_nums, sketch_refine_adds_partition[i], color='black')
    plt.scatter(partition_nums, sketch_refine_adds_partition[i], color='black')
    dr = plt.plot(partition_nums, [direct[i][-1]] * len(partition_nums), '--', color='red')
    plt.title(f"Q{i+1}")
    plt.yscale('log')
    plt.grid(axis="x")
    plt.xlabel("Partition Number")

plt.legend(["Sketch Refine", "Direct"], loc='center', bbox_to_anchor=(1.3, 0.95))
plt.show()